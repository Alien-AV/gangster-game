<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mafia Manager Prototype</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .counter { margin: 4px 0; }
        button { margin: 4px 0; }
        .action { display: flex; align-items: center; margin: 4px 0; }
        .action button { margin: 0; }
        .action .progress { margin-left: 8px; }
        .hidden { display: none; }
        .progress { width: 200px; background: #ccc; height: 16px; margin: 0; position: relative; }
        .progress-bar { height: 100%; width: 0%; background: #4caf50; transition: width 0.1s linear; }
    </style>
</head>
<body>
<h1>Mafia Manager Prototype</h1>
<div class="counter">Money: $<span id="money">0</span></div>
<div class="counter">Mooks (patrolling): <span id="mooks">0</span></div>
<div class="counter">Territory: <span id="territory">1</span> block(s)</div>
<div class="counter">Heat: <span id="heat">0</span></div>
<div class="counter">Businesses: <span id="businesses">0</span></div>
<div class="counter">Faces: <span id="faces">0</span> - Idle: <span id="facesIdle">0</span> - Extort: <span id="facesExtortCount">0</span> - Hire: <span id="facesHireCount">0</span></div>
<div class="counter">Boss Task: <span id="bossTask">extort</span></div>
<div class="counter">Fists: <span id="fists">0</span></div>
<div class="counter">Brains: <span id="brains">0</span></div>
<div class="counter">Illicit Businesses: <span id="illicit">0</span></div>
<hr>
<div class="action">
    <button id="setBossExtort">Boss to Extort</button>
    <button id="setBossHire">Boss to Hire</button>
    <button id="setBossFist">Boss to Fist</button>
</div>

<div class="action">
    <button id="recruitMook" class="hidden">Recruit Mook ($5)</button>
    <div id="recruitMookProgress" class="progress hidden"><div class="progress-bar"></div></div>
</div>


<div class="action">
    <button id="recruitLieutenant" class="hidden">Recruit Lieutenant ($20)</button>
    <div id="recruitLieutenantProgress" class="progress hidden"><div class="progress-bar"></div></div>
</div>
<div id="lieutenantChoice" class="hidden">
    <p>Select lieutenant type:</p>
    <button id="chooseFace">Face</button>
    <button id="chooseFist">Fist</button>
    <button id="chooseBrain">Brain</button>
</div>

<div class="action">
    <button id="assignFaceExtort" class="hidden">Assign Face to Extort</button>
    <button id="unassignFaceExtort" class="hidden">Unassign</button>
</div>
<div class="action">
    <button id="assignFaceHire" class="hidden">Assign Face to Hire</button>
    <button id="unassignFaceHire" class="hidden">Unassign</button>
</div>
<div class="action">
    <button id="extortAction" class="hidden">Extort</button>
    <div id="faceExtortProgress" class="progress hidden"><div class="progress-bar"></div></div>
</div>

<div class="action">
    <button id="buyBusiness" class="hidden">Buy Business ($100)</button>
    <div id="buyBusinessProgress" class="progress hidden"><div class="progress-bar"></div></div>
</div>
<div class="action">
    <button id="buildIllicit" class="hidden">Build Illicit Business</button>
    <div id="buildIllicitProgress" class="progress hidden"><div class="progress-bar"></div></div>
</div>

<div class="action">
    <button id="payCops" class="hidden">Pay Off Cops ($50)</button>
    <div id="payCopsProgress" class="progress hidden"><div class="progress-bar"></div></div>
</div>

<script>
const state = {
    money: 0,
    mooks: 0,
    territory: 1,
    heat: 0,
    businesses: 0,
    faces: 0,
    faceIdle: 0,
    faceExtort: 0,
    faceHire: 0,
    fists: 0,
    brains: 0,
    bossTask: 'extort',
    unlockedMook: false,
    unlockedLieutenant: false,
    unlockedFaceExtort: false,
    unlockedBusiness: false,
    illicit: 0,
    unlockedIllicit: false,
};

function updateUI() {
    document.getElementById('money').textContent = state.money;
    document.getElementById('mooks').textContent = state.mooks;
    document.getElementById('territory').textContent = state.territory;
    document.getElementById('heat').textContent = state.heat;
    document.getElementById('businesses').textContent = state.businesses;
    document.getElementById('faces').textContent = state.faces;
    document.getElementById('facesIdle').textContent = state.faceIdle;
    document.getElementById('facesExtortCount').textContent = state.faceExtort;
    document.getElementById('facesHireCount').textContent = state.faceHire;
    document.getElementById('fists').textContent = state.fists;
    document.getElementById('brains').textContent = state.brains;
    document.getElementById('bossTask').textContent = state.bossTask;

    document.getElementById('illicit').textContent = state.illicit;
    if (state.unlockedMook) document.getElementById('recruitMook').classList.remove('hidden');
    if (state.unlockedLieutenant) document.getElementById('recruitLieutenant').classList.remove('hidden');
    if (state.unlockedFaceExtort && state.faces > 0) {
        document.getElementById('assignFaceExtort').classList.remove('hidden');
        document.getElementById('assignFaceHire').classList.remove('hidden');
        document.getElementById('unassignFaceExtort').classList.remove('hidden');
        document.getElementById('unassignFaceHire').classList.remove('hidden');
        document.getElementById('extortAction').classList.remove('hidden');
    } else {
        document.getElementById('assignFaceExtort').classList.add('hidden');
        document.getElementById('assignFaceHire').classList.add('hidden');
        document.getElementById('unassignFaceExtort').classList.add('hidden');
        document.getElementById('unassignFaceHire').classList.add('hidden');
        document.getElementById('extortAction').classList.add('hidden');
    }
    if (state.unlockedBusiness) document.getElementById('buyBusiness').classList.remove('hidden');
    if (state.unlockedIllicit && state.businesses > state.illicit && state.brains > 0) document.getElementById("buildIllicit").classList.remove("hidden");
    else document.getElementById("buildIllicit").classList.add("hidden");
    if (state.heat > 0) document.getElementById('payCops').classList.remove('hidden');
}

function runProgress(progressId, duration, callback) {
    const bar = document.querySelector(`#${progressId} .progress-bar`);
    const container = document.getElementById(progressId);
    container.classList.remove('hidden');
    bar.style.width = '0%';
    const start = Date.now();
    const interval = setInterval(() => {
        const elapsed = Date.now() - start;
        const percent = Math.min(elapsed / duration * 100, 100);
        bar.style.width = percent + '%';
        if (elapsed >= duration) {
            clearInterval(interval);
            container.classList.add('hidden');
            callback();
            updateUI();
        }
    }, 100);
}

function showLieutenantTypeSelection(callback) {
    const container = document.getElementById('lieutenantChoice');
    container.classList.remove('hidden');

    function choose(type) {
        container.classList.add('hidden');
        document.getElementById('chooseFace').onclick = null;
        document.getElementById('chooseFist').onclick = null;
        document.getElementById('chooseBrain').onclick = null;
        callback(type);
        updateUI();
    }

    document.getElementById('chooseFace').onclick = () => choose('face');
    document.getElementById('chooseFist').onclick = () => choose('fist');
    document.getElementById('chooseBrain').onclick = () => choose('brain');
}

function setBossTask(task) {
    state.bossTask = task;
    updateUI();
}

document.getElementById('setBossExtort').onclick = () => setBossTask('extort');
document.getElementById('setBossHire').onclick = () => setBossTask('hire');
document.getElementById('setBossFist').onclick = () => setBossTask('fist');


function recruitMook() {
    const recruiters = state.faceHire + (state.bossTask === 'hire' ? 1 : 0);
    if (recruiters <= 0) return alert('No gangsters assigned to hire');
    const totalCost = 5 * recruiters;
    if (state.money < totalCost) return alert('Not enough money');
    document.getElementById('recruitMook').disabled = true;
    state.money -= totalCost;
    runProgress('recruitMookProgress', 2000, () => {
        state.mooks += recruiters;
        state.unlockedLieutenant = true;
        document.getElementById('recruitMook').disabled = false;
        checkHeat();
    });
}

document.getElementById('recruitMook').onclick = recruitMook;


function recruitLieutenant() {
    if (state.money < 20) return alert('Not enough money');
    document.getElementById('recruitLieutenant').disabled = true;
    state.money -= 20;
    runProgress('recruitLieutenantProgress', 3000, () => {
        showLieutenantTypeSelection(choice => {
            if (choice === 'face') { 
                state.faces += 1; 
                state.faceIdle += 1; 
                state.unlockedFaceExtort = true; 
            }
            else if (choice === 'fist') { state.fists += 1; }
            else if (choice === 'brain') { state.brains += 1; }
            document.getElementById('recruitLieutenant').disabled = false;
        });
    });
}

document.getElementById('recruitLieutenant').onclick = recruitLieutenant;

function extortAction() {
    const extorters = state.faceExtort + (state.bossTask === 'extort' ? 1 : 0);
    if (extorters <= 0) return alert('No gangsters assigned to extort');
    document.getElementById('extortAction').disabled = true;
    runProgress('faceExtortProgress', 4000, () => {
        state.money += 15 * state.territory * extorters;
        state.territory += extorters;
        if (state.mooks < state.territory) state.heat += 1;
        document.getElementById('extortAction').disabled = false;
        state.unlockedBusiness = true;
        state.unlockedMook = true;
    });
}

document.getElementById('extortAction').onclick = extortAction;

function assignFaceExtort() {
    if (state.faceIdle <= 0) return alert('No idle faces');
    state.faceIdle -= 1;
    state.faceExtort += 1;
    updateUI();
}

function unassignFaceExtort() {
    if (state.faceExtort <= 0) return;
    state.faceExtort -= 1;
    state.faceIdle += 1;
    updateUI();
}

function assignFaceHire() {
    if (state.faceIdle <= 0) return alert('No idle faces');
    state.faceIdle -= 1;
    state.faceHire += 1;
    updateUI();
}

function unassignFaceHire() {
    if (state.faceHire <= 0) return;
    state.faceHire -= 1;
    state.faceIdle += 1;
    updateUI();
}

document.getElementById('assignFaceExtort').onclick = assignFaceExtort;
document.getElementById('unassignFaceExtort').onclick = unassignFaceExtort;
document.getElementById('assignFaceHire').onclick = assignFaceHire;
document.getElementById('unassignFaceHire').onclick = unassignFaceHire;

function checkHeat() {
    if (state.mooks < state.territory) state.heat += 1;
}

function buyBusiness() {
    if (state.money < 100) return alert('Not enough money');
    document.getElementById('buyBusiness').disabled = true;
    state.money -= 100;
    runProgress('buyBusinessProgress', 5000, () => {
        state.businesses += 1;
        state.unlockedIllicit = true;
        document.getElementById('buyBusiness').disabled = false;
    });
}

document.getElementById('buyBusiness').onclick = buyBusiness;

function buildIllicit() {
    if (state.businesses <= state.illicit) return alert("No available fronts");
    if (state.brains <= 0) return alert("Need a brain lieutenant");
    document.getElementById("buildIllicit").disabled = true;
    state.brains -= 1;
    runProgress("buildIllicitProgress", 4000, () => {
        state.illicit += 1;
        document.getElementById("buildIllicit").disabled = false;
    });
}

document.getElementById("buildIllicit").onclick = buildIllicit;

function payCops() {
    if (state.money < 50) return alert('Not enough money');
    document.getElementById('payCops').disabled = true;
    state.money -= 50;
    runProgress('payCopsProgress', 3000, () => {
        state.heat = Math.max(0, state.heat - 1);
        document.getElementById('payCops').disabled = false;
        if (state.heat === 0) document.getElementById('payCops').classList.add('hidden');
    });
}

document.getElementById('payCops').onclick = payCops;
setInterval(() => {
    if (state.illicit > 0) {
        state.money += state.illicit * 5;
        updateUI();
    }
}, 5000);

updateUI();
</script>
</body>
</html>
